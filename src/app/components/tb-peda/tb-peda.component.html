<app-menu></app-menu>
<!-- dashboard.component.html -->
<div class="container-fluid">
  <h1 class="my-4 text-primary">Tableau de Bord Pédagogique</h1>

  <!-- Cartes de synthèse -->
  <div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                Total Étudiants
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ totalStudents }}</div>
            </div>
            <div class="col-auto">
              <i class="fas fa-users fa-2x text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                Classes Actives
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ activeClasses }}</div>
            </div>
            <div class="col-auto">
              <i class="fas fa-door-open fa-2x text-success"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                Parcours Actifs
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ activePaths }}</div>
            </div>
            <div class="col-auto">
              <i class="fas fa-road fa-2x text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2 combo-container">
              <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                Année Académique
              </div>
              <div class="combo-select">
                <select
                  (change)="totalEleves(selectAnnee);totalActiveClasses(selectAnnee)"
                  class="form-select"
                  aria-label="Sélectionner l'année académique"
                  id="annee-select" [(ngModel)]="selectAnnee">
                  @for (annee of anneeScolaires(); track annee) {
                    <option [value]="annee.annee_Sco">{{ annee.annee_Sco }}</option>
                  }
                </select>
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-calendar-alt fa-2x text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Effectifs par niveau -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Effectifs par Niveau</h6>
        </div>
        <div class="card-body">
          <canvas #levelChart width="100%" height="80"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Répartition par Type</h6>
        </div>
        <div class="card-body">
          <canvas #typeChart width="100%" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Effectifs par parcours -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
      <h6 class="m-0 font-weight-bold text-primary">Effectifs par Parcours</h6>
      <select class="form-select w-25" (change)="updatePathChart()">
        <option value="all">Tous niveaux</option>
        @for (level of levels; track level) {
          <option [value]="level.id">{{ level.name }}</option>
        }
      </select>
    </div>
    <div class="card-body">
      <canvas #pathChart width="100%" height="50"></canvas>
    </div>
  </div>

  <!-- Classes par année académique -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Classes Ouvertes par Année Académique</h6>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="thead-light">
            <tr>
              <th>Année Académique</th>
              <th>Licence 1</th>
              <th>Licence 2</th>
              <th>Licence 3</th>
              <th>Master 1</th>
              <th>Master 2</th>
              <th>Total</th>
              <th>Taux d'ouverture</th>
            </tr>
          </thead>
          <tbody>
            @for (year of academicYears; track year) {
              <tr>
                <td>{{ year.year }}</td>
                <td>{{ year.licence1 }}</td>
                <td>{{ year.licence2 }}</td>
                <td>{{ year.licence3 }}</td>
                <td>{{ year.master1 }}</td>
                <td>{{ year.master2 }}</td>
                <td class="font-weight-bold">{{ year.total }}</td>
                <td>
                  <div class="progress">
                  <div class="progress-bar" [ngClass]="{
                    'bg-success': year.rate >= 75,
                    'bg-warning': year.rate >= 50 && year.rate < 75,
                    'bg-danger': year.rate < 50
                  }" [style.width]="year.rate + '%'">
                      {{ year.rate }}%
                    </div>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Détail des parcours -->
  <div class="card shadow">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Détail des Effectifs par Parcours et Niveau</h6>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead>
            <tr>
              <th rowspan="2">Parcours</th>
              <th colspan="5" class="text-center">Niveaux</th>
              <th rowspan="2">Total</th>
            </tr>
            <tr>
              <th>Licence 1</th>
              <th>Licence 2</th>
              <th>Licence 3</th>
              <th>Master 1</th>
              <th>Master 2</th>
            </tr>
          </thead>
          <tbody>
            @for (path of pathDetails; track path) {
              <tr>
                <td>{{ path.name }}</td>
                <td>{{ path.licence1 }}</td>
                <td>{{ path.licence2 }}</td>
                <td>{{ path.licence3 }}</td>
                <td>{{ path.master1 }}</td>
                <td>{{ path.master2 }}</td>
                <td class="font-weight-bold">{{ path.total }}</td>
              </tr>
            }
            <tr class="font-weight-bold">
              <td>Total</td>
              <td>{{ totals.licence1 }}</td>
              <td>{{ totals.licence2 }}</td>
              <td>{{ totals.licence3 }}</td>
              <td>{{ totals.master1 }}</td>
              <td>{{ totals.master2 }}</td>
              <td>{{ totals.general }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
