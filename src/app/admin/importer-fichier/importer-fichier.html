<app-menu></app-menu>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-12">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">
            <i class="fas fa-file-import me-2"></i>
            Importer un fichier
          </h3>
        </div>

        <div class="card-body">
          <div class="mb-4">
            <label class="form-label fw-bold" for="fileInput">
              <i class="fas fa-file me-2"></i>
              Sélectionner un fichier
            </label>

            <div class="input-group">
              <input
                #fileInput
                (change)="onFileSelected($event)"
                accept=".csv,.xlsx,.xls,.txt"
                class="form-control"
                id="fileInput"
                type="file"
              >
              <button
                (click)="fileInput.click()"
                class="btn btn-outline-secondary"
                type="button">
                <i class="fas fa-folder-open"></i>
              </button>
            </div>

            <div class="form-text">
              Formats supportés: CSV, Excel (.xlsx, .xls), TXT
            </div>
          </div>

          <div *ngIf="fileName" class="mb-4">
            <div class="alert alert-info d-flex align-items-center">
              <i class="fas fa-file-alt me-3 fs-4"></i>
              <div>
                <strong>Fichier sélectionné :</strong>
                <div class="text-break">{{ fileName }}</div>
                <small class="text-muted">
                  Prêt à être importé
                </small>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button
              (click)="annulerImport()"
              [disabled]="!fileName"
              class="btn btn-outline-danger px-4"
              type="button">
              <i class="fas fa-times me-2"></i>
              Annuler
            </button>

            <button
              (click)="importerFichier()"
              [disabled]="!fileName"
              class="btn btn-success px-4"
              type="button">
              <i class="fas fa-upload me-2"></i>
              Importer le fichier
            </button>
          </div>

          <div *ngIf="data.length" class="mt-3 mb-3 d-flex align-items-center">
            <label class="me-2 mb-0">Lignes par page :</label>
            <select (ngModelChange)="changePageSize($event)" [(ngModel)]="pageSize" class="form-select w-auto">
              <option *ngFor="let size of [5,10,20,50]" [value]="size">{{ size }}</option>
            </select>
          </div>
          <div *ngIf="data.length" class="alert alert-secondary d-flex justify-content-between align-items-center">
  <span>
    <i class="fas fa-list me-2"></i>
    <strong>Nombre total de lignes :</strong> {{ totalLignes }}
  </span>

            <span class="text-muted small">
    Page {{ page }} / {{ totalPages }}
  </span>
          </div>

          <div *ngIf="data.length" class="mt-3">
            <div class="d-flex mb-2">
              <button (click)="traiterDonnees()" *ngIf="showTraitement" class="btn btn-warning me-2">
                <i class="fas fa-cogs me-1"></i> Traitement
              </button>
            </div>

            <div *ngIf="data.length" class="alert alert-info mb-2">
              <strong>Source des données :</strong>
              <span *ngIf="tableSource === 'FILE'">Fichier à importer</span>
              <span *ngIf="tableSource === 'BACK'">AdministrationTempo</span>
            </div>

            <div class="table-responsive">
              <table class="table table-bordered table-striped text-nowrap">
                <thead class="table-dark">
                <tr>
                  <th *ngFor="let col of columns">
                    {{ col.label }}
                  </th>
                </tr>
                <tr>
                  <th *ngFor="let col of columns">
                    <input
                      [(ngModel)]="filters[col.key]"
                      (ngModelChange)="filtrerTableau()"
                      class="form-control form-control-sm"
                      placeholder="Recherche..."
                    />
                  </th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let row of paginatedData">
                  <td *ngFor="let col of columns" class="text-nowrap">
                    {{ formatCell(row[col.key], col.label) }}
                  </td>
                </tr>
                </tbody>
              </table>
            </div>

            <nav aria-label="Pagination" class="mt-2">
              <ul class="pagination justify-content-center">
                <li [class.disabled]="page === 1" class="page-item">
                  <button (click)="changePage(page - 1)" class="page-link">Précédent</button>
                </li>
                <li *ngFor="let p of [].constructor(totalPages); let i = index" [class.active]="page === i+1"
                    class="page-item">
                  <button (click)="changePage(i+1)" class="page-link">{{ i + 1 }}</button>
                </li>
                <li [class.disabled]="page === totalPages" class="page-item">
                  <button (click)="changePage(page + 1)" class="page-link">Suivant</button>
                </li>
              </ul>
            </nav>
          </div>

          <div class="mt-5 pt-3 border-top">
            <h5 class="text-muted">
              <i class="fas fa-info-circle me-2"></i>
              Instructions
            </h5>
            <ul class="text-muted small">
              <li>Assurez-vous que le fichier est correctement formaté</li>
              <li>Vérifiez les données avant l'importation</li>
              <li>La taille maximale est de 10MB</li>
              <li>L'importation peut prendre quelques minutes</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
