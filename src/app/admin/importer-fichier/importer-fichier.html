<app-menu></app-menu> 
<div class="container mt-5"> 
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-12">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">
            <i class="fas fa-file-import me-2"></i>
            Importer un fichier
          </h3>
        </div>
        
        <div class="card-body">
          <!-- 1. Sélection de fichier -->
          <div class="mb-4">
            <label for="fileInput" class="form-label fw-bold">
              <i class="fas fa-file me-2"></i>
              Sélectionner un fichier
            </label>
            
            <div class="input-group">
              <input 
                type="file" 
                id="fileInput"
                class="form-control"
                (change)="onFileSelected($event)"
                accept=".csv,.xlsx,.xls,.txt"
                #fileInput
              >
              <button 
                class="btn btn-outline-secondary" 
                type="button"
                (click)="fileInput.click()">
                <i class="fas fa-folder-open"></i>
              </button>
            </div>
            
            <div class="form-text">
              Formats supportés: CSV, Excel (.xlsx, .xls), TXT
            </div>
          </div>
          
          <!-- 2. Nom du fichier sélectionné -->
          <div class="mb-4" *ngIf="fileName">
            <div class="alert alert-info d-flex align-items-center">
              <i class="fas fa-file-alt me-3 fs-4"></i>
              <div>
                <strong>Fichier sélectionné :</strong>
                <div class="text-break">{{ fileName }}</div>
                <small class="text-muted">
                  Prêt à être importé
                </small>
              </div>
            </div>
          </div>
          
          <!-- 3. Boutons d'action -->
          <div class="d-flex justify-content-between mt-4">
            <button 
              type="button" 
              class="btn btn-outline-danger px-4"
              (click)="annulerImport()"
              [disabled]="!fileName">
              <i class="fas fa-times me-2"></i>
              Annuler
            </button>
            
            <button 
              type="button" 
              class="btn btn-success px-4"
              (click)="importerFichier()"
              [disabled]="!fileName">
              <i class="fas fa-upload me-2"></i>
              Importer le fichier
            </button>
          </div>

          <!-- 4. Sélection "Lignes par page" au-dessus du tableau -->
          <div *ngIf="data.length" class="mt-3 mb-3 d-flex align-items-center">
            <label class="me-2 mb-0">Lignes par page :</label>
            <select class="form-select w-auto" [(ngModel)]="pageSize" (ngModelChange)="changePageSize($event)">
              <option *ngFor="let size of [5,10,20,50]" [value]="size">{{ size }}</option>
            </select>
          </div>
          
          <!-- 5. Tableau des données -->
          <div *ngIf="data.length" class="mt-3">
            <div class="d-flex mb-2">
              <button *ngIf="showTraitement" class="btn btn-warning me-2" (click)="traiterDonnees()">
                <i class="fas fa-cogs me-1"></i> Traitement
              </button>
            </div>
            
            <div class="table-responsive">
              <table class="table table-bordered table-striped">
                <thead class="table-dark">
                  <tr>
                    <th *ngFor="let col of columns">{{ col }}</th>
                  </tr>
                  <tr>
                    <th *ngFor="let col of columns">
                      <input type="text" class="form-control form-control-sm"
                             placeholder="Recherche..."
                             [(ngModel)]="filters[col]"
                             (ngModelChange)="filtrerTableau()" />
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of paginatedData">
                    <td *ngFor="let col of columns">{{ row[col] }}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- 6. Pagination en bas -->
            <nav aria-label="Pagination" class="mt-2">
              <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="page === 1">
                  <button class="page-link" (click)="changePage(page - 1)">Précédent</button>
                </li>
                <li class="page-item" *ngFor="let p of [].constructor(totalPages); let i = index"
                    [class.active]="page === i+1">
                  <button class="page-link" (click)="changePage(i+1)">{{ i+1 }}</button>
                </li>
                <li class="page-item" [class.disabled]="page === totalPages">
                  <button class="page-link" (click)="changePage(page + 1)">Suivant</button>
                </li>
              </ul>
            </nav>
          </div>
          
          <!-- Instructions -->
          <div class="mt-5 pt-3 border-top">
            <h5 class="text-muted">
              <i class="fas fa-info-circle me-2"></i>
              Instructions
            </h5>
            <ul class="text-muted small">
              <li>Assurez-vous que le fichier est correctement formaté</li>
              <li>Vérifiez les données avant l'importation</li>
              <li>La taille maximale est de 10MB</li>
              <li>L'importation peut prendre quelques minutes</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
