<app-menu></app-menu>
<div class="container">
  <!-- En-t√™te -->
  <div class="header">
    <h1>√âtat Liste des √âl√®ves</h1>
    <div class="api-status" [class.connected]="apiStatus === 'API connect√©e'"
      [class.disconnected]="apiStatus !== 'API connect√©e'">
      üì° {{ apiStatus }}
    </div>
  </div>

  <!-- Formulaire de recherche -->
  <div class="search-form">
    <div class="form-row">
      <!-- Campus -->
      <div class="form-group">
        <label for="campus">Campus :</label>
        <select id="campus" [(ngModel)]="campus" class="form-control">
          <option value="">S√©lectionnez un campus</option>
          @for (campus of campuses; track campus) {
            <option [value]="campus">{{ campus }}</option>
          }
        </select>
      </div>

      <!-- Ann√©e Scolaire -->
      <div class="form-group">
        <label for="anneeScolaire">Ann√©e Scolaire :</label>
        <select id="anneeScolaire" [(ngModel)]="anneeScolaire" class="form-control">
          <option value="">S√©lectionnez une ann√©e</option>
          @for (annee of anneesScolaires; track annee) {
            <option [value]="annee">{{ annee }}</option>
          }
        </select>
      </div>

      <!-- Classe -->
      <div class="form-group">
        <label for="classe">Classe :</label>
        <input type="text"
          id="classe"
          [(ngModel)]="classe"
          class="form-control"
          [placeholder]="'Ex: ' + getRandomExample()"
          maxlength="50">
          <small class="form-text text-muted">
            Saisir le code de la classe (ex: URGL1, BTS2, LICENCE1)
          </small>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="action-buttons">
        <button type="button"
          class="btn btn-success"
          (click)="exportToExcel()"
          [disabled]="isLoading || !campus || !anneeScolaire || !classe">
          @if (isLoading) {
            <span class="spinner-border spinner-border-sm" role="status"></span>
          }
          {{ isLoading ? 'G√©n√©ration...' : 'Impression Excel' }}
        </button>

        <button type="button" class="btn btn-secondary" (click)="resetForm()">
          Nouvelle Recherche
        </button>

        <button type="button" class="btn btn-info" (click)="exportToPDF()">
          Impression PDF
        </button>
      </div>
    </div>

    <!-- Messages -->
    @if (errorMessage) {
      <div class="alert"
        [class.alert-success]="errorMessage.includes('succ√®s')"
        [class.alert-danger]="!errorMessage.includes('succ√®s') && errorMessage.includes('Erreur')"
        [class.alert-info]="!errorMessage.includes('succ√®s') && !errorMessage.includes('Erreur')">
        {{ errorMessage }}
      </div>
    }

    <!-- R√©sum√© apr√®s recherche -->
    @if (campus && anneeScolaire && classe) {
      <div class="results-section">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Crit√®res de recherche s√©lectionn√©s</h5>
            <p class="card-text"><strong>Campus:</strong> {{ campus }}</p>
            <p class="card-text"><strong>Ann√©e Scolaire:</strong> {{ anneeScolaire }}</p>
            <p class="card-text"><strong>Classe:</strong> {{ classe }}</p>
            <p class="card-text text-success">‚úÖ Pr√™t pour l'export</p>
          </div>
        </div>
      </div>
    }
  </div>
